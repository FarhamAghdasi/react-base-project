import React, { useState, useEffect } from 'react';
import './App.css';

const Game = () => {
  const [isGameStarted, setIsGameStarted] = useState(false);
  const [isGameOver, setIsGameOver] = useState(false);
  const [score, setScore] = useState(0);
  const [rocketPosition, setRocketPosition] = useState(50);
  const [obstacles, setObstacles] = useState([]);

  const moveRocket = (e) => {
    if (!isGameStarted || isGameOver) return;
    const speed = 10;
    if (e.key === 'ArrowLeft') {
      setRocketPosition(prev => Math.max(0, prev - speed));
    }
    if (e.key === 'ArrowRight') {
      setRocketPosition(prev => Math.min(90, prev + speed));
    }
  };

  const generateObstacle = () => {
    if (!isGameStarted || isGameOver) return;
    const newObstacle = {
      id: Date.now(),
      x: Math.random() * 90,
      y: 0
    };
    setObstacles(prev => [...prev, newObstacle]);
  };

  const checkCollision = () => {
    const rocketLeft = rocketPosition;
    const rocketRight = rocketPosition + 10;
    
    return obstacles.some(obstacle => {
      const obstacleLeft = obstacle.x;
      const obstacleRight = obstacle.x + 10;
      const obstacleBottom = obstacle.y + 10;
      
      return (
        obstacleBottom >= 90 &&
        rocketLeft < obstacleRight &&
        rocketRight > obstacleLeft
      );
    });
  };

  useEffect(() => {
    if (isGameStarted && !isGameOver) {
      const handle = setInterval(generateObstacle, 2000);
      return () => clearInterval(handle);
    }
  }, [isGameStarted, isGameOver]);

  useEffect(() => {
    if (isGameStarted && !isGameOver) {
      const handle = setInterval(() => {
        setObstacles(prev => 
          prev.map(obs => ({ ...obs, y: obs.y + 2 }))
               .filter(obs => obs.y < 100)
        );
        setScore(prev => prev + 1);
      }, 50);

      return () => clearInterval(handle);
    }
  }, [isGameStarted, isGameOver]);

  useEffect(() => {
    if (isGameStarted && !isGameOver) {
      window.addEventListener('keydown', moveRocket);
      return () => window.removeEventListener('keydown', moveRocket);
    }
  }, [isGameStarted, isGameOver]);

  useEffect(() => {
    if (checkCollision()) {
      setIsGameOver(true);
    }
  }, [obstacles]);

  const startGame = () => {
    setIsGameStarted(true);
    setIsGameOver(false);
    setScore(0);
    setRocketPosition(50);
    setObstacles([]);
  };

  // بقیه کد مانند قبل...
};

export default Game;
